<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Small Tip Angle Approximation Â· KomaMRI.jl: General MRI simulation framework</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/extra-styles.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="KomaMRI.jl: General MRI simulation framework logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="KomaMRI.jl: General MRI simulation framework logo"/></a><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../getting-started/">Getting Started</a></li><li><a class="tocitem" href="../../ui-details/">Graphical User Interface</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../lit-01-FID/">Free Induction Decay</a></li><li class="is-active"><a class="tocitem" href>Small Tip Angle Approximation</a></li><li><a class="tocitem" href="../lit-03-ChemicalShiftEPI/">Chemical Shift in an EPI sequence</a></li><li><a class="tocitem" href="../lit-04-3DSliceSelective/">Slice Selective Acquisition of 3D Phantom</a></li></ul></li><li><a class="tocitem" href="../../mri-theory/">Simulation Method</a></li><li><a class="tocitem" href="../../api/">API Documentation</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Small Tip Angle Approximation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Small Tip Angle Approximation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/cncastillo/KomaMRI.jl/blob/master/examples/lit-02-SmallTipApproximation.jl" title="Edit on GitHub"><span class="docs-icon fab">ï‚›</span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Small-Tip-Angle-Approximation"><a class="docs-heading-anchor" href="#Small-Tip-Angle-Approximation">Small Tip Angle Approximation</a><a id="Small-Tip-Angle-Approximation-1"></a><a class="docs-heading-anchor-permalink" href="#Small-Tip-Angle-Approximation" title="Permalink"></a></h1><p><a href="https://github.com/cncastillo/KomaMRI.jl/blob/master/examples/lit-02-SmallTipApproximation.jl"><img src="https://img.shields.io/badge/julia-script-9558B2?logo=julia" alt/></a></p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">false</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This example replicates the results of page 41 on the book &quot;Handbook of MRI Pulse Sequences&quot; by Bernstein et al.</p></div></div><pre class="documenter-example-output"><code class="nohighlight hljs ansi">50</code></pre><p>In this example we will showcase the small tip angle approximation. For this, we will simulate a slice profile for spins&#39; postitions <span>$z\in[-2,\,2]\,\mathrm{cm}$</span> and will choose a gradient <span>$G_{z}$</span> so their frequencies are mapped to <span>$f\in[-5,\,5]\,\mathrm{kHZ}$</span>. To start, we define an RF pulse with a flip angle of 30 deg and pulse duration of <span>$T_{\mathrm{rf}}=3.2\,\mathrm{ms}$</span>.</p><pre><code class="language- hljs">B1 = 4.92e-6
Trf = 3.2e-3
zmax = 2e-2
fmax = 5e3
z = range(-zmax, zmax, 400)
Gz = fmax / (Î³ * zmax)
f = Î³ * Gz * z
Î± = KomaMRI.get_flip_angles(seq)[1] #Approx 30 deg</code></pre><p>The designed RF pulse will look like this (see figure below), where the gradient after the RF pulse has half of the area of the first one to refocuse the spins&#39; phase after the excitation.</p><pre><code class="language-julia hljs">seq = PulseDesigner.RF_sinc(B1, Trf, sys; G=[0;0;Gz], TBP=8)
p2 = plot_seq(seq; max_rf_samples=Inf, slider=false)</code></pre><object type="text/html" data="../../assets/42-seq.html" style="width:100%; height:380px;"></object><p>Now we will perform the simulation using the function <a href="../../api/#KomaMRI.simulate_slice_profile"><code>simulate_slice_profile</code></a>. Note that we modified <code>Î”t_rf</code> in <code>simParams</code> to match the resolution of the waveform.</p><pre><code class="language-julia hljs">simParams = Dict{String, Any}(&quot;Î”t_rf&quot; =&gt; Trf / length(seq.RF.A[1]))
M = simulate_slice_profile(seq; z, simParams)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Mag{Float32}(ComplexF32[-0.00015141992f0 + 0.000220705f0im, -0.00014948046f0 + 0.00021912142f0im, -0.00014888938f0 + 0.00020918257f0im, -0.00014948017f0 + 0.0001919581f0im, -0.00015087996f0 + 0.00016886687f0im, -0.00015272867f0 + 0.00014161711f0im, -0.00015481393f0 + 0.00011227771f0im, -0.0001566378f0 + 8.291111f-5im, -0.00015793489f0 + 5.5656186f-5im, -0.00015838796f0 + 3.255425f-5im  â€¦  0.00015838796f0 + 3.255425f-5im, 0.00015793489f0 + 5.5656186f-5im, 0.0001566378f0 + 8.291111f-5im, 0.00015481393f0 + 0.00011227771f0im, 0.00015272867f0 + 0.00014161711f0im, 0.00015087996f0 + 0.00016886687f0im, 0.00014948017f0 + 0.0001919581f0im, 0.00014888938f0 + 0.00020918257f0im, 0.00014948046f0 + 0.00021912142f0im, 0.00015141992f0 + 0.000220705f0im], Float32[1.0000061, 0.99999785, 0.9999992, 0.99999666, 1.0000052, 0.99999934, 1.0000005, 1.0000056, 0.9999973, 1.0000046  â€¦  1.0000046, 0.9999973, 1.0000056, 1.0000005, 0.99999934, 1.0000052, 0.99999666, 0.9999992, 0.99999785, 1.0000061])</code></pre><p>Simulation results</p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">scatter with fields name, type, x, and y
</code></pre><p>Small tip approximation</p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">scatter with fields line, name, type, x, and y
</code></pre><p>Plot all results</p><p>Which produces the follwoing slice profile:</p><object type="text/html" data="../../assets/4b-profile.html" style="width:100%; height:380px;"></object><p>For a flip angle of 30 deg the slice profile is very close to the small tip angle approximation, the Fourier transform of <span>$B_{1}(t)$</span>.</p><p>But what will happen if we use a flip angle of 120 deg instead?</p><pre><code class="language-julia hljs">Î±_desired = 120 + 0im               # The multiplication of a complex number scales the RF pulse of a Sequence
Î± = KomaMRI.get_flip_angles(seq)[1] #Previous FA approx 30 deg
seq = (Î±_desired / Î±) * seq         # Scaling the pulse to have a flip angle of 120
M = simulate_slice_profile(seq; z, simParams)

#Plot simulation results</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">scatter with fields name, type, x, and y
</code></pre><p>Small tip approximation</p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">scatter with fields line, name, type, x, and y
</code></pre><p>Plot all results</p><object type="text/html" data="../../assets/4a-profile.html" style="width:100%; height:320px;"></object><p>For this case the small tip angle approximation breaks ðŸ˜¢ (thus, the reason for its name!), and the slice profile is not similar to <span>$\mathcal{F}\left(B_{1}\left(t\right)\right)$</span>.</p><p>This basic sinc pulse is not very <span>$B_{1}$</span> insensitive, for this, is better to use adiabatic RF pulses. Watch out for a future example ðŸ‘€ with adiabatic RF pulses.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../lit-01-FID/">Â« Free Induction Decay</a><a class="docs-footer-nextpage" href="../lit-03-ChemicalShiftEPI/">Chemical Shift in an EPI sequence Â»</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.17 on <span class="colophon-date" title="Tuesday 27 December 2022 16:31">Tuesday 27 December 2022</span>. Using Julia version 1.8.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
